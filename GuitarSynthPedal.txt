#include <Arduino.h>
#include <Wire.h>
#include <Adafruit_VS1053.h>
#include <LiquidCrystal_I2C.h>

// Define pins for VS1053
#define VS1053_RST  9
#define VS1053_CS   10
#define VS1053_DCS  6
#define VS1053_DREQ 3

// Define pins for potentiometers
#define PITCH_POT A0
#define FILTER_POT A1
#define MOD_POT A2

// Define pins for 3PDT footswitch
#define FOOTSWITCH_PIN 15
#define LED_PIN 5

// Initialize LCD
LiquidCrystal_I2C lcd(0x27, 16, 2);

// Initialize VS1053
Adafruit_VS1053_FilePlayer musicPlayer = 
    Adafruit_VS1053_FilePlayer(VS1053_RST, VS1053_CS, VS1053_DCS, VS1053_DREQ);

void setup() {
    Serial.begin(115200);
    pinMode(FOOTSWITCH_PIN, INPUT_PULLUP);
    pinMode(LED_PIN, OUTPUT);
    pinMode(PITCH_POT, INPUT);
    pinMode(FILTER_POT, INPUT);
    pinMode(MOD_POT, INPUT);
    
    // Initialize LCD
    lcd.begin();
    lcd.backlight();
    lcd.setCursor(0, 0);
    lcd.print("Guitar Synth Ready");
    
    // Initialize VS1053
    if (!musicPlayer.begin()) {
        Serial.println("VS1053 not found");
        lcd.setCursor(0, 1);
        lcd.print("VS1053 Error");
        while (1);
    }
    musicPlayer.sineTest(0x44, 500);
}

void loop() {
    int pitch = analogRead(PITCH_POT);
    int filter = analogRead(FILTER_POT);
    int mod = analogRead(MOD_POT);
    
    bool footswitchState = digitalRead(FOOTSWITCH_PIN) == LOW;
    digitalWrite(LED_PIN, footswitchState);
    
    lcd.setCursor(0, 1);
    lcd.print("P:"); lcd.print(pitch);
    lcd.print(" F:"); lcd.print(filter);
    lcd.print(" M:"); lcd.print(mod);
    
    delay(100);
}
